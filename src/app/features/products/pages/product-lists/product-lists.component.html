<div class="container">
<div class="filters" [formGroup]="filtersForm">
  <input type="text" formControlName="searchTerm" placeholder="Search products..." />
  <input type="number" formControlName="min" placeholder="Min price" />
  <input type="number" formControlName="max" placeholder="Max price" />

  <!-- Sorting -->
  <select formControlName="sortBy">
    <option [ngValue]="null">Sort By</option>
    <option value="price">Price</option>
    <option value="title">Title</option>
  </select>
  <select formControlName="sortOrder">
    <option [ngValue]="null">Order</option>
    <option value="asc">Ascending</option>
    <option value="desc">Descending</option>
  </select>
</div>

<div class="categories">
  <button
    *ngFor="let cat of (categories$ | async)"
    (click)="onCategorySelect(cat)"
    [class.active]="(selectedCategory$ | async) === cat">
    {{ cat }}
  </button>
</div>


<!-- Loading skeletons -->
<div *ngIf="loading$ | async" class="grid">
  <ngx-skeleton-loader
    *ngFor="let item of [1,2,3,4,5,6]"
    appearance="line"
    [theme]="{ width: '100%', height: '20rem' }">
  </ngx-skeleton-loader>
</div>

<!-- Error message -->
<div *ngIf="error$ | async as error" class="error">
  <p>⚠️ {{ error }}</p>
  <!-- <button (click)="reload()">Retry</button> -->
</div>

<!-- <cdk-virtual-scroll-viewport
  itemSize="250"
  class="grid"
  *ngIf="!(loading$ | async)">

  <div class="card" *cdkVirtualFor="let product of (products$ | async)">
    <a [routerLink]="['/', 'products', product.id]">
      <img [src]="product.image" [alt]="product.title" />
      <h3>{{ product.title }}</h3>
    </a>
    <p>{{ product.price | currency }}</p>
  </div>

</cdk-virtual-scroll-viewport> -->

<div class="grid" *ngIf="!(loading$ | async)">
  <div
    class="card"
    *ngFor="let product of (products$ | async) ; trackBy: trackByProduct"
    >
    <div
      class="image-container"
      [routerLink]="['/products', product.id]"
      >
      <img [src]="product.image" [alt]="product.title" />
    </div>
    <div class="content">
      <h3>{{ product.title }}</h3>
      <div class="category-Rating">
        <p class="category">
          {{ product.category }}
        </p>
        <div Class="Rating">
          <span class="star">★</span>
          <strong class="rating-value"> {{ product.rating?.rate }}  </strong>
          <span>({{ product.rating?.count }})</span>
        </div>
      </div>
      <div class="custom-divider"></div>
      <div class="add-to-cart-and-price">
        <strong class="price">{{ product.price | currency }}</strong>

 <!-- Cart button -->
        <ng-container *ngIf="isInCart(product.id) | async; else addCartBtn">
          <button
            (click)="removeFromCart(product.id)"
            class="Remove-from-cart"
          >
            Remove from Cart
          </button>
        </ng-container>
        <ng-template #addCartBtn>
          <button
            class="Add-to-cart"
            (click)="addToCart(product)"
          >
            Add to Cart
          </button>
        </ng-template>

        <!-- <button class="Add-to-cart">Add to cart</button>
        <button class="Remove-from-cart">Remove from cart</button> -->
      </div>
    </div>
  </div>
</div>


<div class="pagination">
  <button (click)="prevPage()" [disabled]="currentPage === 1">Prev</button>
  <span>Page {{ currentPage }} of {{ totalPages }}</span>
  <button (click)="nextPage()" [disabled]="currentPage === totalPages">Next</button>
</div>

<div class="pagination-controls">
  <label>
    Products per page:
    <select [(ngModel)]="pageSize" (change)="onPageSizeChange($event)">
      <option [value]="5">5</option>
      <option [value]="10" selected>10</option>
      <option [value]="20">20</option>
      <option [value]="50">50</option>
    </select>
  </label>
</div>


</div>
